generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ─────────────────────────────────────────────────────────────
// USER
// ─────────────────────────────────────────────────────────────
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  password  String?
  role      UserRole @default(OWNER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  stores Store[]

  @@map("users")
}

enum UserRole {
  OWNER
  MANAGER
  STAFF
}

// ─────────────────────────────────────────────────────────────
// STORE
// ─────────────────────────────────────────────────────────────
model Store {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  ownerId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner      User        @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  products   Product[]
  sales      Sale[]

  @@index([ownerId])
  @@map("stores")
}

// ─────────────────────────────────────────────────────────────
// PRODUCT
// ─────────────────────────────────────────────────────────────
model Product {
  id        String   @id @default(uuid())
  storeId   String
  name      String
  sku       String
  unit      String   @default("unit")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  store       Store       @relation(fields: [storeId], references: [id], onDelete: Cascade)
  inventory   Inventory?
  sales       Sale[]
  predictions Prediction[]

  @@unique([storeId, sku])
  @@index([storeId])
  @@map("products")
}

// ─────────────────────────────────────────────────────────────
// INVENTORY
// ─────────────────────────────────────────────────────────────
model Inventory {
  id           String   @id @default(uuid())
  productId    String   @unique
  quantity     Int      @default(0)
  reorderPoint Int      @default(0)
  updatedAt    DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("inventory")
}

// ─────────────────────────────────────────────────────────────
// SALE
// ─────────────────────────────────────────────────────────────
model Sale {
  id          String   @id @default(uuid())
  storeId     String
  productId   String
  quantity    Int
  totalAmount Decimal  @db.Decimal(12, 2)
  soldAt      DateTime @default(now())
  createdAt   DateTime @default(now())

  store   Store   @relation(fields: [storeId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([storeId, soldAt])
  @@index([productId, soldAt])
  @@map("sales")
}

// ─────────────────────────────────────────────────────────────
// PREDICTION
// ─────────────────────────────────────────────────────────────
model Prediction {
  id              String   @id @default(uuid())
  productId       String
  predictedDemand Int
  forecastDate    DateTime
  createdAt       DateTime @default(now())

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([productId, createdAt])
  @@index([productId, forecastDate])
  @@map("predictions")
}
